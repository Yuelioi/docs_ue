/*!
 * History API JavaScript Library v4.2.0
 *
 * Support: IE8+, FF3+, Opera 9+, Safari, Chrome and other
 *
 * Copyright 2011-2014, Dmitrii Pakhtinov ( spb.piksel@gmail.com )
 *
 * http://spb-piksel.ru/
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Update: 2014-11-06 21:35
 */
(function(n){typeof define=="function"&&define.amd?define(typeof document!="object"||document.readyState!=="loading"?[]:"html5-history-api",n):n()})(function(){function st(){}function u(n,f,o){var h,c,l,a;n==null||n===""||f?(n=f?n:t.href,(!e||o)&&(n=n.replace(/^[^#]*/,"")||"#",n=t.protocol.replace(/:.*$|$/,":")+"//"+t.host+r.basepath+n.replace(new RegExp("^#[/]?(?:"+r.type+")?"),""))):(h=u(),c=i.getElementsByTagName("base")[0],!o&&c&&c.getAttribute("href")&&(c.href=c.href,h=u(c.href,null,!0)),l=h._pathname,a=h._protocol,n=""+n,n=/^(?:\w+\:)?\/\//.test(n)?n.indexOf("/")===0?a+n:n:a+"//"+h._host+(n.indexOf("/")===0?n:n.indexOf("?")===0?l+n:n.indexOf("#")===0?l+h._search+n:l.replace(/[^\/]+$/g,"")+n));at.href=n;var s=/(?:(\w+\:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/.exec(at.href),w=s[2]+(s[3]?":"+s[3]:""),v=s[4]||"/",y=s[5]||"",p=s[6]==="#"?"":s[6]||"",b=v+y+p,k=v.replace(new RegExp("^"+r.basepath,"i"),r.type)+y;return{_href:s[1]+"//"+w+b,_protocol:s[1],_host:w,_hostname:s[2],_port:s[3]||"",_pathname:v,_search:y,_hash:p,_relative:b,_nohash:k,_special:k+p}}function ri(){var r;try{r=n.sessionStorage;r.setItem(g+"t","1");r.removeItem(g+"t")}catch(u){r={getItem:function(n){var t=i.cookie.split(n+"=");return t.length>1&&t.pop().split(";").shift()||"null"},setItem:function(n){var r={};(r[t.href]=f.state)&&(i.cookie=n+"="+b.stringify(r))}}}try{l=b.parse(r.getItem(g))||{}}catch(u){l={}}h(c+"unload",function(){r.setItem(g,b.stringify(l))},!1)}function tt(t,i,r,u){var l=0,a,f,e;r||(r={set:st},l=1);var o=!r.set,s=!r.get,c={configurable:!0,set:function(){o=1},get:function(){s=1}};try{y(t,i,c);t[i]=t[i];y(t,i,r)}catch(v){}if((!o||!s)&&(t.__defineGetter__&&(t.__defineGetter__(i,c.get),t.__defineSetter__(i,c.set),t[i]=t[i],r.get&&t.__defineGetter__(i,r.get),r.set&&t.__defineSetter__(i,r.set)),!o||!s)){if(l)return!1;if(t===n){try{a=t[i];t[i]=null}catch(v){}if("execScript"in n)n.execScript("Public "+i,"VBScript"),n.execScript("var "+i+";","JavaScript");else try{y(t,i,{value:st})}catch(v){i==="onpopstate"&&(h("popstate",r=function(){ot("popstate",r,!1);var n=t.onpopstate;t.onpopstate=null;setTimeout(function(){t.onpopstate=n},1)},!1),yt=0)}t[i]=a}else try{try{f=ut.create(t);y(ut.getPrototypeOf(f)===t?f:t,i,r);for(e in t)typeof t[e]=="function"&&(f[e]=t[e].bind(t));try{u.call(f,f,t)}catch(v){}t=f}catch(v){y(t.constructor.prototype,i,r)}}catch(v){return!1}}return t}function ui(n,i,r){return r=r||{},n=n===bt?t:n,r.set=r.set||function(t){n[i]=t},r.get=r.get||function(){return n[i]},r}function fi(n,t,i){n in a?a[n].push(t):arguments.length>3?h(n,t,i,arguments[3]):h(n,t,i)}function ei(n,t,i){var r=a[n],u;if(r){for(u=r.length;u--;)if(r[u]===t){r.splice(u,1);break}}else ot(n,t,i)}function it(t,i){var u=(""+(typeof t=="string"?t:t.type)).replace(/^on/,""),f=a[u],e,r,o;if(f){if(i=typeof t=="string"?i:t,i.target==null)for(e=["target","currentTarget","srcElement","type"];t=e.pop();)i=tt(i,t,{get:t==="type"?function(){return u}:function(){return n}});for(yt&&((u==="popstate"?n.onpopstate:n.onhashchange)||st).call(n,i),r=0,o=f.length;r<o;r++)f[r].call(n,i);return!0}return ti(t,i)}function kt(){var n=i.createEvent?i.createEvent("Event"):i.createEventObject();n.initEvent?n.initEvent("popstate",!1,!1):n.type="popstate";n.state=f.state;it(n)}function oi(){nt&&(nt=!1,kt())}function w(n,i,r,f){if(e)p=t.href;else{o===0&&(o=2);var s=u(i,o===2&&(""+i).indexOf("#")!==-1);s._relative!==u()._relative&&(p=f,r?t.replace("#"+s._special):t.hash=s._special)}!k&&n&&(l[t.href]=n);nt=!1}function dt(i){var e=p,r,f;p=t.href;e&&(vt!==t.href&&kt(),i=i||n.event,r=u(e,!0),f=u(),i.oldURL||(i.oldURL=r._href,i.newURL=f._href),r._hash!==f._hash&&it(i))}function gt(n){setTimeout(function(){h("popstate",function(n){vt=t.href;k||(n=tt(n,"state",{get:function(){return f.state}}));it(n)},!1)},0);!e&&n!==!0&&"location"in f&&(ni(d.hash),oi())}function si(n){while(n){if(n.nodeName==="A")return n;n=n.parentNode}}function hi(t){var i=t||n.event,f=si(i.target||i.srcElement),o="defaultPrevented"in i?i.defaultPrevented:i.returnValue===!1;if(f&&f.nodeName==="A"&&!o){var e=u(),r=u(f.getAttribute("href",2)),s=e._href.split("#").shift()===r._href.split("#").shift();s&&r._hash&&(e._hash!==r._hash&&(d.hash=r._hash),ni(r._hash),i.preventDefault?i.preventDefault():i.returnValue=!1)}}function ni(t){var r=i.getElementById(t=(t||"").replace(/^#/,"")),u;r&&r.id===t&&r.nodeName==="A"&&(u=r.getBoundingClientRect(),n.scrollTo(rt.scrollLeft||0,u.top+(rt.scrollTop||0)-(rt.clientTop||0)))}function ci(){var v=i.getElementsByTagName("script"),y=(v[v.length-1]||{}).src||"",w=y.indexOf("?")!==-1?y.split("?").pop():"",s,t,l,p;for(w.replace(/(\w+)(?:=([^&]*))?/g,function(n,t,i){r[t]=(i||"").replace(/^(0|false)$/,"")}),h(c+"hashchange",dt,!1),s=[bt,d,ii,n,wt,f],k&&delete wt.state,t=0;t<s.length;t+=2)for(l in s[t])if(s[t].hasOwnProperty(l))if(typeof s[t][l]=="function")s[t+1][l]=s[t][l];else{if(p=ui(s[t],l,s[t][l]),!tt(s[t+1],l,p,function(i,r){r===f&&(n.history=f=s[t+1]=i)}))return ot(c+"hashchange",dt,!1),!1;s[t+1]===n&&(a[l]=a[l.substr(2)]=[])}return f.setup(),r.redirect&&f.redirect(),r.init&&(o=1),!k&&b&&ri(),e||i[et](c+"click",hi,!1),i.readyState==="complete"?gt(!0):(e||u()._relative===r.basepath||(nt=!0),h(c+"load",gt,!1)),!0}var n=(typeof window=="object"?window:this)||{};if(!n.history||"emulate"in n.history)return n.history;var i=n.document,rt=i.documentElement,ut=n.Object,b=n.JSON,t=n.location,s=n.history,f=s,ft=s.pushState,ht=s.replaceState,e=!!ft,k="state"in s,y=ut.defineProperty,d=tt({},"t")?{}:i.createElement("a"),c="",et=n.addEventListener?"addEventListener":(c="on")&&"attachEvent",ct=n.removeEventListener?"removeEventListener":"detachEvent",lt=n.dispatchEvent?"dispatchEvent":"fireEvent",h=n[et],ot=n[ct],ti=n[lt],r={basepath:"/",redirect:0,type:"/",init:0},g="__historyAPI__",at=i.createElement("a"),p=t.href,vt="",yt=1,nt=!1,o=0,l={},a={},v=i.title,ii={onhashchange:null,onpopstate:null},pt=function(t,i){var r=n.history!==s;r&&(n.history=s);t.apply(s,i);r&&(n.history=f)},wt={setup:function(n,t,i){r.basepath=(""+(n==null?r.basepath:n)).replace(/(?:^|\/)[^\/]*$/,"/");r.type=t==null?r.type:t;r.redirect=i==null?r.redirect:!!i},redirect:function(i,o){if(f.setup(o,i),o=r.basepath,n.top==n.self){var h=u(null,!1,!0)._relative,s=t.pathname+t.search;e?(s=s.replace(/([^\/])$/,"$1/"),h!=o&&new RegExp("^"+o+"$","i").test(s)&&t.replace(h)):s!=o&&(s=s.replace(/([^\/])\?/,"$1/?"),new RegExp("^"+o,"i").test(s)&&t.replace(o+"#"+s.replace(new RegExp("^"+o,"i"),r.type)+t.hash))}},pushState:function(n,t,r){var u=i.title;v!=null&&(i.title=v);ft&&pt(ft,arguments);w(n,r);i.title=u;v=t},replaceState:function(n,r,u){var f=i.title;v!=null&&(i.title=v);delete l[t.href];ht&&pt(ht,arguments);w(n,u,!0);i.title=f;v=r},location:{set:function(t){o===0&&(o=1);n.location=t},get:function(){return o===0&&(o=1),e?t:d}},state:{get:function(){return l[t.href]||null}}},bt={assign:function(n){(""+n).indexOf("#")===0?w(null,n):t.assign(n)},reload:function(){t.reload()},replace:function(n){(""+n).indexOf("#")===0?w(null,n,!0):t.replace(n)},toString:function(){return this.href},href:{get:function(){return u()._href}},protocol:null,host:null,hostname:null,port:null,pathname:{get:function(){return u()._pathname}},search:{get:function(){return u()._search}},hash:{set:function(n){w(null,(""+n).replace(/^(#|)/,"#"),!1,p)},get:function(){return u()._hash}}};if(ci())return f.emulate=!e,n[et]=fi,n[ct]=ei,n[lt]=it,f})