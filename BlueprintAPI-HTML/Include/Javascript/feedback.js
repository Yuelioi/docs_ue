(function(n,t,i){if(n.Feedback===i){var s=function(t){n.console.log(t)},o=function(n){for(var t,r=0,u=n.length;r<u;r++)t=Array.prototype.pop.call(n),t!==i&&t.parentNode!==null&&t.parentNode.removeChild(t)},c=function(){var n=t.createElement("div"),i=3;for(n.className="feedback-loader";i--;)n.appendChild(t.createElement("span"));return n},l=function(n){return n.getBoundingClientRect()},e=function(n){for(var t;(t=n.firstChild)!==null?n.removeChild(t):!1;);},f=function(n,i){var r=t.createElement(n);return r.appendChild(t.createTextNode(i)),r},a=function(t,r){if(t.onload===i)if(t.onreadystatechange!==i){var u=function(){t.readyState!=="loaded"&&t.readyState!=="complete"?n.setTimeout(u,250):r()};n.setTimeout(u,250)}else s("ERROR: We can't track when script is loaded");else return r},r,h="data-html2canvas-ignore",u=t.createElement("div");n.Feedback=function(s){s=s||{};s.label=s.label||"Send Feedback";s.header=s.header||"Send Feedback";s.url=s.url||"/";s.adapter=s.adapter||new n.Feedback.XHR(s.url);s.nextLabel=s.nextLabel||"Continue";s.reviewLabel=s.reviewLabel||"Review";s.sendLabel=s.sendLabel||"Send";s.closeLabel=s.closeLabel||"Close";s.messageSuccess=s.messageSuccess||"Your feedback was sent succesfully.";s.messageError=s.messageError||"There was an error sending your feedback to the server.";s.pages===i&&(s.pages=[new n.Feedback.Form,new n.Feedback.Screenshot(s),new n.Feedback.Review]);var v,a,l,y=t.createElement("div"),p={open:function(){var w=s.pages.length;for(l=0;l<w;l++)s.pages[l]instanceof n.Feedback.Review||s.pages[l].render();var o=f("a","×"),i=t.createElement("div"),c=t.createElement("div");a=t.createElement("div");t.body.appendChild(y);o.className="feedback-close";o.onclick=p.close;o.href="#";v.disabled=!0;i.appendChild(o);i.appendChild(f("h3",s.header));i.className="feedback-header";u.className="feedback-body";e(u);l=0;u.appendChild(s.pages[l++].dom);r=f("button",s.nextLabel);r.className="feedback-btn";r.onclick=function(){l>0&&s.pages[l-1].end(a)===!1||(e(u),l===w?p.send(s.adapter):(s.pages[l].start(a,i,c,r),s.pages[l]instanceof n.Feedback.Review&&s.pages[l].render(s.pages),u.appendChild(s.pages[l++].dom),l===w&&(r.firstChild.nodeValue=s.sendLabel),s.pages[l]instanceof n.Feedback.Review&&(r.firstChild.nodeValue=s.reviewLabel)))};c.className="feedback-footer";c.appendChild(r);a.className="feedback-modal";a.setAttribute(h,!0);a.appendChild(i);a.appendChild(u);a.appendChild(c);t.body.appendChild(a)},close:function(){v.disabled=!1;o([a,y]);l>0&&s.pages[l-1].end(a);for(var n=0,t=s.pages.length;n<t;n++)s.pages[n].close();return!1},send:function(i){if(!(i instanceof n.Feedback.Send))throw new Error("Adapter is not an instance of Feedback.Send");for(var f=0,l=s.pages.length,o=[],a=0,h;f<l;f++)(h=s.pages[f].data())!==!1&&(o[a++]=h);r.disabled=!0;e(u);u.appendChild(c());i.send(o,function(n){e(u);r.disabled=!1;r.firstChild.nodeValue=s.closeLabel;r.onclick=function(){return p.close(),!1};n===!0?u.appendChild(t.createTextNode(s.messageSuccess)):u.appendChild(t.createTextNode(s.messageError))})}};return y.className="feedback-glass",y.style.pointerEvents="none",y.setAttribute(h,!0),s=s||{},v=f("button",s.label),v.className="feedback-btn feedback-bottom-right",v.setAttribute(h,!0),v.onclick=p.open,s.appendTo!==null&&(s.appendTo!==i?s.appendTo:t.body).appendChild(v),p};n.Feedback.Page=function(){};n.Feedback.Page.prototype={render:function(n){this.dom=n},start:function(){},close:function(){},data:function(){return!1},review:function(){return null},end:function(){return!0}};n.Feedback.Send=function(){};n.Feedback.Send.prototype={send:function(){}};n.Feedback.Form=function(n){this.elements=n||[{type:"textarea",name:"Issue",label:"Please describe the issue you are experiencing",required:!1}];this.dom=t.createElement("div")};n.Feedback.Form.prototype=new n.Feedback.Page;n.Feedback.Form.prototype.render=function(){var i=0,r=this.elements.length,n;for(e(this.dom);i<r;i++){n=this.elements[i];switch(n.type){case"textarea":this.dom.appendChild(f("label",n.label+":"+(n.required===!0?" *":"")));this.dom.appendChild(n.element=t.createElement("textarea"))}}return this};n.Feedback.Form.prototype.end=function(){for(var t=0,i=this.elements.length,n;t<i;t++){if(n=this.elements[t],n.required===!0&&n.element.value.length===0)return n.element.className="feedback-error",!1;n.element.className=""}return!0};n.Feedback.Form.prototype.data=function(){if(this._data!==i)return this._data;for(var n=0,u=this.elements.length,t,r={};n<u;n++)t=this.elements[n],r[t.name]=t.element.value;return this._data=r};n.Feedback.Form.prototype.review=function(n){for(var r=0,i,u=this.elements.length;r<u;r++)i=this.elements[r],i.element.value.length>0&&(n.appendChild(f("label",i.name+":")),n.appendChild(t.createTextNode(i.element.value.length)),n.appendChild(t.createElement("hr")));return n};n.Feedback.Review=function(){this.dom=t.createElement("div");this.dom.className="feedback-review"};n.Feedback.Review.prototype=new n.Feedback.Page;n.Feedback.Review.prototype.render=function(n){var t=0,i=n.length;for(e(this.dom);t<i;t++)n[t].review(this.dom);return this};n.Feedback.Screenshot=function(n){this.options=n||{};this.options.blackoutClass=this.options.blackoutClass||"feedback-blackedout";this.options.highlightClass=this.options.highlightClass||"feedback-highlighted";this.h2cDone=!1};n.Feedback.Screenshot.prototype=new n.Feedback.Page;n.Feedback.Screenshot.prototype.end=function(n){n.className=n.className.replace(/feedback\-animate\-toside/,"");t.body.removeEventListener("mousemove",this.mouseMoveEvent,!1);t.body.removeEventListener("click",this.mouseClickEvent,!1);o([this.h2cCanvas]);this.h2cDone=!1};n.Feedback.Screenshot.prototype.close=function(){o([this.blackoutBox,this.highlightContainer,this.highlightBox,this.highlightClose]);o(t.getElementsByClassName(this.options.blackoutClass));o(t.getElementsByClassName(this.options.highlightClass))};n.Feedback.Screenshot.prototype.start=function(r,u,o,s){var d,p,ht,a;if(this.h2cDone){e(this.dom);s.disabled=!1;var a=this,ft="feedback-highlight-element",g="data-exclude",nt=!0;this.mouseMoveEvent=function(t){var f,e;if(t.target!==y&&(t.target.className.indexOf(a.options.blackoutClass)!==-1||t.target.className.indexOf(a.options.highlightClass)!==-1)){f=parseInt(t.target.style.left,10)+parseInt(t.target.style.width,10);f=Math.max(f,10);f=Math.min(f,n.innerWidth-15);e=parseInt(t.target.style.top,10);e=Math.max(e,10);v.style.left=f+"px";v.style.top=e+"px";rt=t.target;ut();y=i;return}if(t.target.nodeName==="BODY"||t.target===v||t.target===r||t.target===s||t.target.parentNode===r||t.target.parentNode===u){ut();y=t.target;return}st();t.target!==y&&(y=t.target,n.clearTimeout(it),it=n.setTimeout(function(){var t=l(y),i;nt===!1?i=w:(i=h,i.width=t.width,i.height=t.height,et.drawImage(a.h2cCanvas,n.pageXOffset+t.left,n.pageYOffset+t.top,t.width,t.height,0,0,t.width,t.height));i.setAttribute(g,!1);i.style.left=n.pageXOffset+t.left+"px";i.style.top=n.pageYOffset+t.top+"px";i.style.width=t.width+"px";i.style.height=t.height+"px"},100))};this.mouseClickEvent=function(n){if(n.preventDefault(),nt===!1){if(w.getAttribute(g)==="false"){var r=t.createElement("div");r.className=a.options.blackoutClass;r.style.left=w.style.left;r.style.top=w.style.top;r.style.width=w.style.width;r.style.height=w.style.height;t.body.appendChild(r);y=i}}else h.getAttribute(g)==="false"&&(h.className+=" "+a.options.highlightClass,h.className=h.className.replace(/feedback\-highlight\-element/g,""),a.highlightBox=h=t.createElement("canvas"),et=h.getContext("2d"),h.className+=" "+ft,t.body.appendChild(h),ut(),y=i)};this.highlightClose=f("div","×");this.blackoutBox=t.createElement("div");this.highlightBox=t.createElement("canvas");this.highlightContainer=t.createElement("div");var it,v=this.highlightClose,h=this.highlightBox,w=this.blackoutBox,b=this.highlightContainer,rt,et=h.getContext("2d"),ct=function(n){n.preventDefault();k.className.indexOf("active")===-1?(k.className+=" active",tt.className=tt.className.replace(/active/g,"")):(tt.className+=" active",k.className=k.className.replace(/active/g,""));nt=!nt},ut=function(){ot(w);ot(h);n.clearTimeout(it)},ot=function(n){n.style.left="-5px";n.style.top="-5px";n.style.width="0px";n.style.height="0px";n.setAttribute(g,!0)},st=function(){v.style.left="-50px";v.style.top="-50px"},k=f("a","Blackout"),tt=f("a","Highlight"),y;for(r.className+=" feedback-animate-toside",v.id="feedback-highlight-close",v.addEventListener("click",function(){rt.parentNode.removeChild(rt);st()},!1),t.body.appendChild(v),this.h2cCanvas.className="feedback-canvas",t.body.appendChild(this.h2cCanvas),d=[tt,k],this.dom.appendChild(f("p","Highlight or blackout important information")),p=0;p<2;p++)d[p].className="feedback-btn feedback-btn-small "+(p===0?"active":"feedback-btn-inverse"),d[p].href="#",d[p].onclick=ct,this.dom.appendChild(d[p]),this.dom.appendChild(t.createTextNode(" "));b.id="feedback-highlight-container";b.style.width=this.h2cCanvas.width+"px";b.style.height=this.h2cCanvas.height+"px";this.highlightBox.className+=" "+ft;this.blackoutBox.id="feedback-blackout-element";t.body.appendChild(this.highlightBox);b.appendChild(this.blackoutBox);t.body.appendChild(b);t.body.addEventListener("mousemove",this.mouseMoveEvent,!1);t.body.addEventListener("click",this.mouseClickEvent,!1)}else ht=arguments,a=this,s.disabled!==!0&&this.dom.appendChild(c()),s.disabled=!0,n.setTimeout(function(){a.start.apply(a,ht)},500)};n.Feedback.Screenshot.prototype.render=function(){var e;this.dom=t.createElement("div");var r,f=this,u=this.options,o=function(){try{u.onrendered=u.onrendered||function(n){f.h2cCanvas=n;f.h2cDone=!0};n.html2canvas([t.body],u)}catch(i){f.h2cDone=!0;s("Error in html2canvas: "+i.message)}};return n.html2canvas===i&&r===i?(r=t.createElement("script"),r.src=u.h2cPath||"libs/html2canvas.js",r.onerror=function(){s("Failed to load html2canvas library, check that the path is correctly defined")},r.onload=a(r,function(){if(n.html2canvas===i){s("Loaded html2canvas, but library not found");return}n.html2canvas.logging=n.Feedback.debug;o()}),e=t.getElementsByTagName("script")[0],e.parentNode.insertBefore(r,e)):o(),this};n.Feedback.Screenshot.prototype.data=function(){var n,u,e,r,f;if(this._data!==i)return this._data;if(this.h2cCanvas!==i){n=this.h2cCanvas.getContext("2d");r=5;n.fillStyle="#000";Array.prototype.slice.call(t.getElementsByClassName("feedback-blackedout"),0).forEach(function(t){var i=l(t);n.fillRect(i.left,i.top,i.width,i.height)});f=Array.prototype.slice.call(t.getElementsByClassName("feedback-highlighted"),0);f.length>0&&(u=t.createElement("canvas"),e=u.getContext("2d"),u.width=this.h2cCanvas.width,u.height=this.h2cCanvas.height,e.drawImage(this.h2cCanvas,0,0),n.fillStyle="#777",n.globalAlpha=.5,n.fillRect(0,0,this.h2cCanvas.width,this.h2cCanvas.height),n.beginPath(),f.forEach(function(t){var i=parseInt(t.style.left,10),u=parseInt(t.style.top,10),f=parseInt(t.style.width,10),e=parseInt(t.style.height,10);n.moveTo(i+r,u);n.lineTo(i+f-r,u);n.quadraticCurveTo(i+f,u,i+f,u+r);n.lineTo(i+f,u+e-r);n.quadraticCurveTo(i+f,u+e,i+f-r,u+e);n.lineTo(i+r,u+e);n.quadraticCurveTo(i,u+e,i,u+e-r);n.lineTo(i,u+r);n.quadraticCurveTo(i,u,i+r,u)}),n.closePath(),n.clip(),n.globalAlpha=1,n.drawImage(u,0,0));try{return this._data=this.h2cCanvas.toDataURL()}catch(o){}}};n.Feedback.Screenshot.prototype.review=function(n){var r=this.data(),t;r!==i&&(t=new Image,t.src=r,t.style.width="300px",n.appendChild(t))};n.Feedback.XHR=function(n){this.xhr=new XMLHttpRequest;this.url=n};n.Feedback.XHR.prototype=new n.Feedback.Send;n.Feedback.XHR.prototype.send=function(t,i){var r=this.xhr;r.onreadystatechange=function(){r.readyState==4&&i(r.status===200)};r.open("POST",this.url,!0);r.setRequestHeader("Content-type","application/x-www-form-urlencoded");r.send("data="+encodeURIComponent(n.JSON.stringify(t)))}}})(window,document)